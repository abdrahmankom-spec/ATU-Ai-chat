<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–î—ç—à–±–æ—Ä–¥</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../css/page.css">
  <link rel="stylesheet" href="../css/dashboard.css">

</head>
<body>
  <main id="app">
    <button class="menu-toggle">‚ò∞</button>
    <nav class="sidebar">
      <h2>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h2>
      <button data-page="dashboard" class="active">üè† –î—ç—à–±–æ—Ä–¥</button>
      <button data-page="schedule">üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
      <button data-page="subjects">üìò –î–∏—Å—Ü–∏–ø–ª–∏–Ω—ã</button>
      <button data-page="tasks">üß© –ó–∞–¥–∞–Ω–∏—è</button>
      <button data-page="courses">üéì –ö—É—Ä—Å—ã</button>
      <button data-page="tests">üß† –ö–æ–Ω—Ç—Ä–æ–ª–∏</button>
      <button data-page="grades">üìä –û—Ü–µ–Ω–∫–∏</button>
        <button  onclick="window.location.href='../index.html'">‚¨Ö –ù–∞–∑–∞–¥</button>
    </nav>

    <section class="page active" id="page-dashboard">
      <div class="card">
        <h3>–ü—Ä–∏–≤–µ—Ç, <span id="user-name">–ì–æ—Å—Ç—å</span>!</h3>
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ç–≤–æ–π –ª–∏—á–Ω—ã–π –¥—ç—à–±–æ—Ä–¥. –ó–¥–µ—Å—å –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –∫–ª—é—á–µ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Ç–≤–æ—ë–º –æ–±—É—á–µ–Ω–∏–∏.</p>
        <a href="floor-1.html" class="btn">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</a>
      </div>
      <div class="card">
        <h3>–í—ã–±–æ—Ä —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</h3>
        <p>–í—ã–±–µ—Ä–∏ —Ü–≤–µ—Ç–æ–≤—É—é —Ç–µ–º—É –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:</p>
        <div class="theme-picker">
          <button data-theme="default">–°–∏–Ω—è—è</button>
          <button data-theme="red">–ö—Ä–∞—Å–Ω–∞—è</button>
          <button data-theme="yellow">–ñ—ë–ª—Ç–∞—è</button>
          <button data-theme="brown">–ö–æ—Ä–∏—á–Ω–µ–≤–∞—è</button>
          <button data-theme="dark">–¢—ë–º–Ω–∞—è</button>
        </div>
      </div>
      
    </section>
    

    <section class="page" id="page-schedule">
      <div class="card">
        <h3>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>
        <div id="schedule-list" class="schedule-list"></div>
      </div>
    </section>
    

    <section class="page" id="page-subjects">
      <div class="card">
        <h3>–ú–æ–∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã</h3>
        <div id="subjects-list" class="subjects-grid"></div>
      </div>
    </section>
    

    <section class="page" id="page-tasks">
      <div class="card"><h3>–ó–∞–¥–∞–Ω–∏—è</h3><p>–¢—É—Ç –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è —Ç–µ–∫—É—â–∏–µ –∑–∞–¥–∞–Ω–∏—è –∏ —Å—Ç–∞—Ç—É—Å—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.</p></div>
    </section>

    <section class="page" id="page-courses">
      <div class="card"><h3>–û–Ω–ª–∞–π–Ω-–∫—É—Ä—Å—ã</h3><p>–î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –∫—É—Ä—Å–∞–º –∏ –æ–±—É—á–∞—é—â–∏–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º.</p></div>
    </section>

    <section class="page" id="page-tests">
      <div class="card"><h3>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3><p>–†–∞–∑–¥–µ–ª –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã—Ö.</p></div>
    </section>

    <section class="page" id="page-grades">
      <div class="card">
        <h3>–ñ—É—Ä–Ω–∞–ª –æ—Ü–µ–Ω–æ–∫</h3>
        <table id="grades-table" style="width:100%;border-collapse:collapse;">
          <thead>
            <tr style="background:hsl(210,85%,50%);color:white;">
              <th style="text-align:left;padding:10px;">–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞</th>
              <th style="padding:10px;">–û—Ü–µ–Ω–∫–∞</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
    
  </main>

  <!-- === –°–∫—Ä–∏–ø—Ç—ã === -->
  <!-- –ø–æ–¥–∫–ª—é—á–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É -->
  <script src="../js/bd.js"></script>
  <script src="../js/main.js"></script>

  <!-- –ø–æ–¥–∫–ª—é—á–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É -->
  <script src="../scripts/page.js"></script>

  <!-- === –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü === -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const pages = document.querySelectorAll('.page');
      const buttons = document.querySelectorAll('.sidebar button[data-page]');
      const sidebar = document.querySelector('.sidebar');
      const toggle = document.querySelector('.menu-toggle');
      const backBtn = document.getElementById('go-back');

      function showPage(pageId) {
        pages.forEach(p => p.classList.toggle('active', p.id === 'page-' + pageId));
        buttons.forEach(b => b.classList.toggle('active', b.dataset.page === pageId));
        sidebar.classList.remove('open');
      }

      buttons.forEach(btn => {
        btn.addEventListener('click', () => showPage(btn.dataset.page));
      });

      toggle.addEventListener('click', () => {
        sidebar.classList.toggle('open');
      });

      backBtn?.addEventListener('click', () => {
        window.location.href = "../index.html";
      });

      // –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const userName = document.getElementById('user-name');
      if (window.DB && userName) {
        const current = DB.getCurrentUser?.();
        const user = current ? DB.getUser(current) : null;
        if (user && user.name) userName.textContent = user.name;
      }
    });
  </script>

  <!-- === –ê–≤—Ç–æ–æ—Ç–∫—Ä—ã—Ç–∏–µ –≤–∫–ª–∞–¥–∫–∏ –ø–æ ?page= === -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(window.location.search);
      const page = params.get('page');
      if (page) {
        const btn = document.querySelector(`.sidebar button[data-page="${page}"]`);
        if (btn) btn.click();
      }
    });
  </script>

  <!-- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö 6 –¥–∏—Å—Ü–∏–ø–ª–∏–Ω –∏ –æ—Ü–µ–Ω–æ–∫ -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (!window.DB) return;
    
      let user = DB.getCurrentUserObj?.();
      if (!user) return;
    
      // –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—â—ë –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫ ‚Äî —Å–æ–∑–¥–∞—ë–º –∏ –ø–µ—Ä–µ—Å–æ—Ö—Ä–∞–Ω—è–µ–º
      if (!user.grades || typeof user.grades !== 'object') {
        console.log('—Å–æ–∑–¥–∞—é –Ω–æ–≤—ã–µ –æ—Ü–µ–Ω–∫–∏ –¥–ª—è', user.name);
        user.grades = DB.generateRandomGrades();
        DB.upsertUser(user);
      }
    
      // –ø–æ–ª—É—á–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
      const table = document.getElementById('grades-table');
      if (!table) return;
      const tbody = table.querySelector('tbody');
      tbody.innerHTML = '';
    
      // —É–±–µ–¥–∏–º—Å—è —á—Ç–æ grades —Ç–æ—á–Ω–æ –µ—Å—Ç—å
      if (!user.grades) {
        console.warn('‚ö† –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', user);
        return;
      }
    
      for (const [subject, grade] of Object.entries(user.grades)) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td style="padding:8px;border-bottom:1px solid #ddd;">${subject}</td>
          <td style="padding:8px;text-align:center;border-bottom:1px solid #ddd;">${grade}</td>
        `;
        const gradeCell = tr.children[1];
        if (grade < 70) gradeCell.style.color = 'crimson';
        else if (grade > 90) gradeCell.style.color = 'green';
        tbody.appendChild(tr);
      }
    });
    </script>
    
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        if (!window.DB) return;
        const user = DB.getCurrentUserObj?.();
        if (!user) return;
      
        // –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –æ—Ü–µ–Ω–æ–∫, —Å–æ–∑–¥–∞–µ–º (–∑–Ω–∞—á–∏—Ç –∏ –ø—Ä–µ–¥–º–µ—Ç—ã —Ç–æ–∂–µ)
        if (!user.grades) {
          user.grades = DB.generateRandomGrades();
          DB.upsertUser(user);
        }
      
        const subjectsContainer = document.getElementById('subjects-list');
        if (!subjectsContainer) return;
      
        subjectsContainer.innerHTML = '';
      
        // –ø–æ–ª—É—á–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω (–±–µ–∑ –æ—Ü–µ–Ω–æ–∫)
        const subjects = Object.keys(user.grades);
        subjects.forEach(subj => {
          const div = document.createElement('div');
          div.className = 'subject-card';
          div.innerHTML = `
            <h4>${subj}</h4>
            <p>–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ò–¢</p>
          `;
          subjectsContainer.appendChild(div);
        });
      });
      </script>
      <script>
        document.addEventListener('DOMContentLoaded', () => {
          if (!window.DB) return;
          const user = DB.getCurrentUserObj?.();
          if (!user) return;
        
          // —Å–æ–∑–¥–∞—ë–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ—Ç
          if (!user.schedule) {
            user.schedule = DB.generateScheduleForUser(user);
            DB.upsertUser(user);
          }
        
          const list = document.getElementById('schedule-list');
          if (!list) return;
          list.innerHTML = '';
        
          // –µ—Å–ª–∏ –Ω–µ—Ç –ø–∞—Ä ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ
          if (!Array.isArray(user.schedule) || user.schedule.length === 0) {
            const empty = document.createElement('div');
            empty.className = 'card';
            empty.textContent = '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.';
            list.appendChild(empty);
            return;
          }
        
          // —Å–≥—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO YYYY-MM-DD)
          const grouped = user.schedule.reduce((acc, pair) => {
            const key = pair.date; // –æ–∂–∏–¥–∞–µ–º YYYY-MM-DD
            if (!acc[key]) acc[key] = [];
            acc[key].push(pair);
            return acc;
          }, {});
        
          // –æ—Ç—Å–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞—Ç—ã –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
          const sortedDates = Object.keys(grouped).sort((a, b) => {
            return new Date(a) - new Date(b);
          });
        
          sortedDates.forEach(dateISO => {
            const pairs = grouped[dateISO];
        
            // —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–∞—Ä –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –≤–Ω—É—Ç—Ä–∏ –¥–Ω—è (–ø–æ startTime)
            pairs.sort((a, b) => a.startTime.localeCompare(b.startTime));
        
            // –ø–∞—Ä—Å–∏–º ISO-–¥–∞—Ç—É –≤ –æ–±—ä–µ–∫—Ç Date –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const [yy, mm, dd] = dateISO.split('-').map(Number);
            const dt = new Date(yy, mm - 1, dd);
            const dayName = dt.toLocaleDateString('ru-RU', { weekday: 'long' });
            const formatted = `${String(dt.getDate()).padStart(2, '0')}.${String(dt.getMonth() + 1).padStart(2, '0')}.${dt.getFullYear()}`;
        
            // –±–ª–æ–∫ –¥–Ω—è
            const dayBlock = document.createElement('div');
            dayBlock.className = 'day-block';
        
            const title = document.createElement('h4');
            title.textContent = `${dayName.charAt(0).toUpperCase() + dayName.slice(1)} ‚Äî ${formatted}`;
            dayBlock.appendChild(title);
        
            // –∫–∞—Ä—Ç–æ—á–∫–∏ –ø–∞—Ä
            pairs.forEach(pair => {
              const card = document.createElement('div');
              card.className = 'pair-card';
              card.innerHTML = `
                <div class="pair-left">
                  <div class="pair-time">${pair.startTime}‚Äì${pair.endTime}</div>
                  <div class="pair-subject">${pair.subject}</div>
                </div>
                <div class="pair-meta">
                  <!-- —Å—é–¥–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞—É–¥–∏—Ç–æ—Ä–∏—é/–ø—Ä–µ–ø–æ–¥–∞ -->
                </div>
              `;
              dayBlock.appendChild(card);
            });
        
            list.appendChild(dayBlock);
          });
        });
        </script>
        
        
    
</body>
</html>


